<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mags Check</title>
  <link rel="stylesheet" href="/brand.css">
</head>
<body>
<div class="container">
  <h1>System Check</h1>
  <ul id="results"></ul>
</div>
<script>
const endpoints = [
  { name: 'api health', url: '/api/health' },
  { name: 'diag notion', url: '/api/diag/notion' },
  { name: 'diag stripe', url: '/api/diag/stripe' },
  { name: 'diag telegram', url: '/api/diag/telegram' },
  { name: 'diag tally', url: '/api/diag/tally' },
];
const params = new URLSearchParams(location.search);
const worker = params.get('worker');
if (worker) {
  endpoints.push({ name: 'worker health', url: worker.replace(/\/$/, '') + '/health' });
}
const ul = document.getElementById('results');
endpoints.forEach(ep => {
  const li = document.createElement('li');
  li.textContent = ep.name + ': â€¦';
  ul.appendChild(li);
  fetch(ep.url)
    .then(r => r.json())
    .then(data => {
      const ok = data && data.ok !== false;
      li.textContent = ep.name + ': ' + (ok ? 'PASS' : `FAIL (${data.reason || 'unknown'})`);
    })
    .catch(() => {
      li.textContent = ep.name + ': FAIL (network)';
    });
});
</script>
</body>
</html>

