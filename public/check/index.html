<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>System Check</title>
  <style>
    .pill{display:inline-block;padding:.35rem .6rem;border-radius:999px;margin:.25rem;background:#eee}
    .ok{background:#d1fae5} .fail{background:#fee2e2}
    small{color:#666;margin-left:.4rem}
  </style>
</head>
<body>
  <h1>System Check</h1>
  <div id="vercel" class="pill">Vercel API <small id="vercel-note"></small></div>
  <div id="worker" class="pill">Worker <small id="worker-note"></small></div>

<script>
const targets = {
  vercel: 'https://mags-assistant.vercel.app/health.json',
  worker: 'https://tight-snow-2840.messyandmagnetic.workers.dev'
};

function badge(el, ok, note){ 
  el.classList.remove('ok','fail'); 
  el.classList.add(ok?'ok':'fail'); 
  el.querySelector('small').textContent = note; 
}

async function probe(name, url){
  const el = document.getElementById(name);
  const ctl = new AbortController();
  const t = setTimeout(()=>ctl.abort(), 6000);
  try{
    const res = await fetch(url, {signal: ctl.signal, headers:{'cache-control':'no-cache'}});
    const code = res.status || 0;
    // Try to parse JSON if it looks like our health.json
    let ok = res.ok;
    let note = `HTTP ${code}`;
    if (name==='vercel' && res.ok){
      try { 
        const j = await res.clone().json();
        ok = j && j.ok === true;
          note = `${note}${ok?' âœ“':''}`;
      } catch {}
    }
    badge(el, ok, note);
  }catch(e){
    badge(el, false, (e.name==='AbortError'?'timeout':'no connection'));
  }finally{ clearTimeout(t); }
}

probe('vercel', targets.vercel);
probe('worker', targets.worker);
</script>
</body>
</html>
