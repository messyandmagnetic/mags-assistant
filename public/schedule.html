<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Schedule Preview</title>
  <style>
    table { border-collapse: collapse; }
    td, th { border: 1px solid #ccc; padding: 4px; }
    img { width: 100px; }
  </style>
</head>
<body>
  <h1>Schedule Preview</h1>
  <table id="queue">
    <thead>
      <tr>
        <th>Source ID</th>
        <th>Emotion</th>
        <th>Booster</th>
        <th>Suggested Sound</th>
        <th>Cover</th>
        <th>Auto-post Time</th>
        <th>Auto-post</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <script>
    let pack;
    async function load() {
      const res = await fetch('schedule-pack.json');
      pack = await res.json();
      const stored = JSON.parse(localStorage.getItem('scheduleQueue') || '[]');
      (pack.queue || []).forEach((item, i) => {
        if (stored[i] && typeof stored[i].autoPost !== 'undefined') {
          item.autoPost = stored[i].autoPost;
        }
      });
      render();
    }
    function render() {
      const tbody = document.querySelector('#queue tbody');
      tbody.innerHTML = '';
      (pack.queue || []).forEach((item, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.sourceId || ''}</td>
          <td>${item.emotion || ''}</td>
          <td>${item.booster && item.booster.done ? '✅' : '⛔'}</td>
          <td>${item.sound || ''}</td>
          <td>${item.cover ? '<img src="' + item.cover + '" width="100" />' : ''}</td>
          <td>${item.scheduledTime ? new Date(item.scheduledTime).toLocaleString() : ''}</td>
          <td><input type="checkbox" ${item.autoPost !== false ? 'checked' : ''} onchange="toggleAuto(${i}, this.checked)"/></td>
        `;
        tbody.appendChild(tr);
      });
    }
    function toggleAuto(i, state) {
      pack.queue[i].autoPost = state;
      localStorage.setItem('scheduleQueue', JSON.stringify(pack.queue));
    }
    load();
  </script>
</body>
</html>
